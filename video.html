
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js canvas - materials - video</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				font-family: Monospace;
				background-color: #f0f0f0;
				margin: 0px;
				overflow: hidden;
			}
		</style>
	</head>
	<body>

		<script src="libs/three.js"></script>

		<script src="libs/video/Projector.js"></script>
		<script src="libs/video/CanvasRenderer.js"></script>

    <!-- load objects -->
    <script src="objects/starfield.js"></script>
    <script src="objects/video.js"></script>
    <script src="objects/light.js"></script>
    <script src="objects/cameraControls.js"></script>
    <script src ="objects/audio/audioAnalyser.js"></script>

		<script src="libs/video/stats.min.js"></script>

		<video id="video" autoplay style="display:none">
			<source src="libs/video/sintel.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
			<source src="libs/video/sintel.ogv" type='video/ogg; codecs="theora, vorbis"'>
		</video>

		<script>
      /**
      * Main Visualizer
      */

      function Visualizer(){

      this.scene =  new THREE.Scene();

      this.audioAnalyser = new AudioAnalyser('objects/audio/CHASING.m4a');

      this.clock = new THREE.Clock();
      this.camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
      this.renderer = new THREE.WebGLRenderer();;

      this.videoCanvas = new VideoCanvas()
      this.starField = new StarField();
      this.light = new Light();

      }

      /**
      * Visualizer functions
      */
      Visualizer.prototype = {

      constructor: Visualizer,
      init:function(){
        this.camera.position.z = 5;
        //set the size of the renderer
        this.renderer.setSize( window.innerWidth, window.innerHeight );

        //add the renderer to the html document body
        document.body.appendChild( this.renderer.domElement );
        this.videoCanvas.addVideo(this.scene)
        this.starField.addStars(this.scene);
        this.light.addLight(this.scene);
        this.audioAnalyser.play();

      },
      render:function(){
        var localRenderer = this;
       //get the frame
       requestAnimationFrame( function(){localRenderer.render();} );
       //render the scene
       this.renderer.setClearColor( 0x000646, 0);
       this.renderer.render( this.scene, this.camera );
       this.starField.animateStars(this.camera, this.scene);

      }

      };

      var viz = new Visualizer;
      viz.init();
      viz.render();




		</script>

	</body>
</html>
